{"ast":null,"code":"import _objectSpread from \"/Users/hucong/Desktop/workspace/creat-app/my/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _objectWithoutProperties from \"/Users/hucong/Desktop/workspace/creat-app/my/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport fetchJsonp from 'fetch-jsonp';\nimport _ from 'lodash';\nimport 'babel-polyfill';\nimport { overTime } from './utils.js';\nwindow.__disableNativeFetch = true;\n\nvar fetch = require('fetch-ie8');\n\nvar beforeGlobalResponse = null;\nvar onGlobalComplete = null;\nvar onGlobalErrorHandler = null;\n\nvar Data = function Data(_ref) {\n  var url = _ref.url,\n      _ref$method = _ref.method,\n      method = _ref$method === void 0 ? 'get' : _ref$method,\n      _ref$headers = _ref.headers,\n      headers = _ref$headers === void 0 ? {} : _ref$headers,\n      options = _objectWithoutProperties(_ref, [\"url\", \"method\", \"headers\"]);\n\n  if (!url) {\n    throw new Error(\"Property 'url' should not be empty!\");\n  }\n\n  if (url.indexOf('/') != 0 && url.indexOf('http') != 0) {\n    url = \"\".concat(URL_PREFIX, \"/\").concat(url);\n  }\n\n  if (method == 'jsonp') {\n    return fetchJsonp(url, options);\n  }\n\n  if (i18n && i18n.language) {\n    headers.locale = i18n.language;\n  }\n\n  var isFormData = options.isFormData;\n  var originHeaders = {\n    'Content-Type': 'application/json;charset=utf-8'\n  };\n  var headersNew = !isFormData ? originHeaders : isFormData;\n  return fetch(url, _objectSpread({\n    method: method,\n    headers: _objectSpread({}, headersNew, headers)\n  }, options)).then(function (response) {\n    return response.json();\n  }).then(function (res) {\n    overTime(res);\n    var newResult = beforeGlobalResponse && beforeGlobalResponse(res);\n    return newResult || res;\n  }).catch(function (err) {\n    console.error(err);\n    return Promise.resolve();\n  });\n}; // 数据请求，全局配置\n\n\nData.setting = function (_ref2) {\n  var beforeResponse = _ref2.beforeResponse,\n      onComplete = _ref2.onComplete,\n      onErrorResponse = _ref2.onErrorResponse;\n\n  if (beforeResponse && beforeResponse.apply) {\n    beforeGlobalResponse = beforeResponse;\n  }\n\n  if (onComplete && onComplete.apply) {\n    onGlobalComplete = onComplete;\n  }\n\n  if (onErrorResponse && onErrorResponse.apply) {\n    onGlobalErrorHandler = onErrorResponse;\n  }\n}; // get 请求\n\n\nData.get = function (_ref3) {\n  var method = _ref3.method,\n      body = _ref3.body,\n      options = _objectWithoutProperties(_ref3, [\"method\", \"body\"]);\n\n  // 把body的参数拼接到url中，并把body参数去掉\n  if (_.isPlainObject(body)) {\n    var url = options.url;\n\n    if (url.indexOf('?') == -1) {\n      url += '?';\n    }\n\n    for (var key in body) {\n      url += \"\".concat(key, \"=\").concat(body[key], \"&\");\n    }\n\n    options.url = url.substring(0, url.length - 1);\n  }\n\n  return Data(_objectSpread({\n    method: 'get'\n  }, options));\n}; // post 请求\n\n\nData.post = function (_ref4) {\n  var method = _ref4.method,\n      params = _ref4.params,\n      body = _ref4.body,\n      options = _objectWithoutProperties(_ref4, [\"method\", \"params\", \"body\"]);\n\n  if (_.isPlainObject(params)) {\n    params = JSON.stringify(params);\n  }\n\n  if (body || params) {\n    options.body = body || params;\n  }\n\n  return Data(_objectSpread({\n    method: 'post'\n  }, options));\n}; // put 请求\n\n\nData.put = function (_ref5) {\n  var method = _ref5.method,\n      options = _objectWithoutProperties(_ref5, [\"method\"]);\n\n  return Data(_objectSpread({\n    method: 'put'\n  }, options));\n}; // delete 请求\n\n\nData.delete = function (_ref6) {\n  var method = _ref6.method,\n      options = _objectWithoutProperties(_ref6, [\"method\"]);\n\n  return Data(_objectSpread({\n    method: 'delete'\n  }, options));\n};\n\nData.jsonp = function (options) {\n  var headers = {};\n  var params = {\n    method: 'GET',\n    headers: _objectSpread({}, headers)\n  };\n  var getQuery = '?';\n  var getUrl = '';\n\n  if (options.query) {\n    for (var name in options.query) {\n      getQuery = \"\".concat(getQuery).concat(name, \"=\").concat(options.query[name], \"&\");\n    }\n  }\n\n  getUrl = options.url + (options.query ? getQuery.substring(0, getQuery.length - 1) : '');\n  return fetchJSON(getUrl, params);\n};\n\nfunction fetchJSON(url, params) {\n  params = _objectSpread({}, params);\n  return fetchJsonp(url, params);\n}\n\nmodule.exports = Data;","map":{"version":3,"sources":["/Users/hucong/Desktop/workspace/creat-app/my/src/client/data/index.js"],"names":["fetchJsonp","_","overTime","window","__disableNativeFetch","fetch","require","beforeGlobalResponse","onGlobalComplete","onGlobalErrorHandler","Data","url","method","headers","options","Error","indexOf","URL_PREFIX","i18n","language","locale","isFormData","originHeaders","headersNew","then","response","json","res","newResult","catch","err","console","error","Promise","resolve","setting","beforeResponse","onComplete","onErrorResponse","apply","get","body","isPlainObject","key","substring","length","post","params","JSON","stringify","put","delete","jsonp","getQuery","getUrl","query","name","fetchJSON","module","exports"],"mappings":"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","sourcesContent":["import fetchJsonp from 'fetch-jsonp';\nimport _ from 'lodash';\nimport 'babel-polyfill';\nimport { overTime } from './utils.js';\n\nwindow.__disableNativeFetch = true;\n\nconst fetch = require('fetch-ie8');\n\nlet beforeGlobalResponse = null;\nlet onGlobalComplete = null;\nlet onGlobalErrorHandler = null;\n\nconst Data = ({ url, method = 'get', headers = {}, ...options }) => {\n  if (!url) {\n    throw new Error(\"Property 'url' should not be empty!\");\n  }\n\n  if (url.indexOf('/') != 0 && url.indexOf('http') != 0) {\n    url = `${URL_PREFIX}/${url}`;\n  }\n\n  if (method == 'jsonp') {\n    return fetchJsonp(url, options);\n  }\n\n  if (i18n && i18n.language) {\n    headers.locale = i18n.language;\n  }\n  const isFormData = options.isFormData;\n  const originHeaders = {\n      'Content-Type': 'application/json;charset=utf-8',\n  };\n  const headersNew = !isFormData ? originHeaders : isFormData;\n  return fetch(url, {\n    method,\n    headers: {\n        ...headersNew,\n        ...headers\n    },\n    ...options\n  })\n    .then(response => {\n      return response.json();\n    })\n    .then(res => {\n      overTime(res);\n      const newResult = beforeGlobalResponse && beforeGlobalResponse(res);\n      return newResult || res;\n    })\n    .catch(err => {\n      console.error(err);\n      return Promise.resolve();\n    });\n};\n\n// 数据请求，全局配置\nData.setting = ({ beforeResponse, onComplete, onErrorResponse }) => {\n  if (beforeResponse && beforeResponse.apply) {\n    beforeGlobalResponse = beforeResponse;\n  }\n\n  if (onComplete && onComplete.apply) {\n    onGlobalComplete = onComplete;\n  }\n\n  if (onErrorResponse && onErrorResponse.apply) {\n    onGlobalErrorHandler = onErrorResponse;\n  }\n};\n\n// get 请求\nData.get = ({ method, body, ...options }) => {\n  // 把body的参数拼接到url中，并把body参数去掉\n  if (_.isPlainObject(body)) {\n    let url = options.url;\n\n    if (url.indexOf('?') == -1) {\n      url += '?';\n    }\n\n    for (let key in body) {\n      url += `${key}=${body[key]}&`;\n    }\n\n    options.url = url.substring(0, url.length - 1);\n  }\n\n  return Data({\n    method: 'get',\n    ...options\n  });\n};\n\n// post 请求\nData.post = ({ method, params, body, ...options }) => {\n  if (_.isPlainObject(params)) {\n    params = JSON.stringify(params);\n  }\n\n  if (body || params) {\n    options.body = body || params;\n  }\n\n  return Data({\n    method: 'post',\n    ...options\n  });\n};\n\n// put 请求\nData.put = ({ method, ...options }) => {\n  return Data({\n    method: 'put',\n    ...options\n  });\n};\n\n// delete 请求\nData.delete = ({ method, ...options }) => {\n  return Data({\n    method: 'delete',\n    ...options\n  });\n};\n\nData.jsonp = options => {\n  let headers = {};\n  const params = {\n    method: 'GET',\n    headers: {\n      ...headers\n    }\n  };\n\n  let getQuery = '?';\n  let getUrl = '';\n  if (options.query) {\n    for (let name in options.query) {\n      getQuery = `${getQuery}${name}=${options.query[name]}&`;\n    }\n  }\n  getUrl =\n    options.url +\n    (options.query ? getQuery.substring(0, getQuery.length - 1) : '');\n\n  return fetchJSON(getUrl, params);\n};\n\nfunction fetchJSON(url, params) {\n  params = {\n    ...params\n  };\n  return fetchJsonp(url, params);\n}\n\nmodule.exports = Data;\n"]},"metadata":{},"sourceType":"module"}